<script>
  const sessionId = 'sess_' + Date.now();
  const messagesDiv = document.getElementById('messages');

  function add(text, sender) {
    const div = document.createElement('div');
    div.className = 'msg ' + (sender === 'user' ? 'user' : '');
    div.innerHTML = text.replace(/\n/g, '<br>');
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  async function send() {
    const input = document.getElementById('msg');
    const text = input.value.trim();
    if (!text) return;
    add(text, 'user');
    input.value = '';

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text, sessionId })
      });
      const data = await res.json();
      add(data.reply || "Ê bro tao đang nghĩ đây, hỏi lại phát ❤️", '');
    } catch (e) {
      add("Mạng lag tí bro, gửi lại phát đi ❤️", '');
    }
  }

  // 2 DÒNG QUAN TRỌNG NHẤT – THIẾU 2 DÒNG NÀY NÊN KHÔNG GỬI ĐƯỢC
  document.querySelector('button').onclick = send;
  document.getElementById('msg').addEventListener('keypress', e => { if (e.key === 'Enter') send(); });

  // Chào hỏi đầu tiên
  add("Ê bro, thằng bạn chí cốt đây! Muốn viết code, hay tìm tin tức gì cứ đập – tao chơi hết! ❤️", '');
</script>
